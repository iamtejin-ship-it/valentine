<script>
  const noBtn = document.getElementById("noBtn");
  let isTouching = false;

  function moveNo(e) {
    if (e && e.type === "touchstart") isTouching = true;

    const padding = 16;
    const btnW = noBtn.offsetWidth;
    const btnH = noBtn.offsetHeight;

    const maxX = window.innerWidth - btnW - padding;
    const maxY = window.innerHeight - btnH - padding;

    const x = Math.max(padding, Math.random() * maxX);
    const y = Math.max(padding, Math.random() * maxY);

    noBtn.style.position = "fixed";
    noBtn.style.transition = "transform 0.15s ease";
    noBtn.style.transform = `translate(${x}px, ${y}px)`;
  }

  // Desktop
  noBtn.addEventListener("mouseenter", moveNo);

  // Mobile
  noBtn.addEventListener("touchstart", (e) => {
    e.preventDefault();
    moveNo(e);
  }, { passive: false });

  // Click safety
  noBtn.addEventListener("click", () => {
    if (isTouching) {
      isTouching = false;
      return;
    }
    showNo();
  });

  function showNo() {
    document.getElementById("ask").style.display = "none";
    document.getElementById("noScreen").style.display = "block";
    burst(40);
  }

  function retry() {
    document.getElementById("noScreen").style.display = "none";
    document.getElementById("ask").style.display = "block";
    burst(30);
  }

  function yes() {
    document.getElementById("ask").style.display = "none";
    document.getElementById("noScreen").style.display = "none";
    document.getElementById("yesScreen").style.display = "block";
    burst(120);
  }

  /* ❤️ HEART CONFETTI */
  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");
  let hearts = [];

  function resize() {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
  }
  resize();
  addEventListener("resize", resize);

  function Heart() {
    this.x = Math.random() * canvas.width;
    this.y = canvas.height + 20;
    this.size = 12 + Math.random() * 16;
    this.speed = 1.5 + Math.random() * 2;
    this.alpha = 1;
  }

  function draw(h) {
    ctx.globalAlpha = h.alpha;
    ctx.fillStyle = "#e63946";
    ctx.beginPath();
    ctx.moveTo(h.x, h.y);
    ctx.bezierCurveTo(h.x + h.size, h.y - h.size, h.x + h.size * 2, h.y + h.size / 3, h.x, h.y + h.size);
    ctx.bezierCurveTo(h.x - h.size * 2, h.y + h.size / 3, h.x - h.size, h.y - h.size, h.x, h.y);
    ctx.fill();
  }

  function burst(n) {
    for (let i = 0; i < n; i++) hearts.push(new Heart());
  }

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    hearts.forEach(h => {
      h.y -= h.speed;
      h.alpha -= 0.012;
      draw(h);
    });
    hearts = hearts.filter(h => h.alpha > 0);
    requestAnimationFrame(animate);
  }
  animate();
</script>


